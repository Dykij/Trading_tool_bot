# Многоисточниковый провайдер рыночных данных и трейдер

## Обзор

Этот набор модулей реализует расширенную систему для работы с данными из нескольких торговых площадок (DMarket, Steam и т.д.) и автоматизации арбитражной торговли между ними. Система построена в соответствии с принципами объектно-ориентированного программирования и предоставляет гибкий интерфейс для интеграции новых источников данных.

## Структура проекта

Реализация состоит из следующих файлов:

### Основные модули

- **`src/api/multi_source_market_provider.py`** - Расширенный провайдер данных с рынка из нескольких источников, включая функции анализа и поиска арбитражных возможностей
- **`src/api/multi_source_trading.py`** - Модуль для выполнения торговых операций на основе арбитражных возможностей
- **`src/api/README_multi_source.md`** - Документация по многоисточниковому провайдеру

### Примеры использования

- **`src/api/examples/multi_source_example.py`** - Пример использования многоисточникового провайдера данных
- **`src/api/examples/multi_source_trading_example.py`** - Пример использования многоисточникового трейдера

### Тесты

- **`src/api/tests/test_multi_source_market_provider.py`** - Модульные тесты для многоисточникового провайдера данных
- **`src/api/tests/test_multi_source_integration.py`** - Интеграционные тесты для всей системы

## Основные возможности

### Многоисточниковый провайдер (`MultiSourceMarketProvider`)

- Получение информации о предметах из различных источников одновременно
- Вычисление статистики по предметам (средняя цена, волатильность, тренд цены)
- Объединение и фильтрация результатов поиска из разных источников
- Поиск арбитражных возможностей между площадками
- Кэширование запросов для оптимизации производительности

### Многоисточниковый трейдер (`MultiSourceTrader`)

- Поиск арбитражных возможностей с учетом минимальной прибыли
- Анализ рисков для каждой торговой возможности
- Автоматическое или ручное выполнение сделок
- Сбор и анализ статистики по выполненным сделкам
- Блокировка предметов после сделки для предотвращения повторной торговли

## Интеграция с существующей системой

Новые модули интегрируются с существующей системой через базовый класс `MarketDataProvider` и используют существующий `MarketDataAggregator` из модуля `multi_source_provider.py`. Они также взаимодействуют с API-клиентами для различных торговых площадок, такими как `DMarketAPI`.

## Архитектурные решения

1. **Паттерн провайдера** - Использование абстрактного базового класса `MarketDataProvider` позволяет легко добавлять новые источники данных
2. **Паттерн одиночки (Singleton)** - Глобальные экземпляры провайдера и трейдера обеспечивают единую точку доступа к функциональности
3. **Асинхронное программирование** - Использование `async/await` для эффективной обработки множественных запросов
4. **Кэширование** - Реализовано кэширование запросов для оптимизации производительности
5. **Обработка ошибок** - Детальная обработка ошибок с использованием специализированных исключений

## Пример использования

```python
import asyncio
from src.api.multi_source_trading import find_and_execute_trades

async def main():
    # Находим и выполняем сделки с минимальной прибылью 7%
    trades = await find_and_execute_trades(
        game_code="a8db",     # Код игры (CS2)
        min_profit=7.0,       # Минимальный процент прибыли
        max_trades=3,         # Максимальное количество сделок
        auto_execute=False    # Запрашивать подтверждение перед сделкой
    )
    
    # Выводим результаты
    for trade in trades:
        print(f"Сделка: {trade['item_name']}")
        print(f"  Покупка: ${trade['buy_price']:.2f} ({trade['buy_source']})")
        print(f"  Продажа: ${trade['sell_price']:.2f} ({trade['sell_source']})")
        print(f"  Прибыль: ${trade['profit']:.2f} ({trade['profit_percent']:.2f}%)")
        print(f"  Статус: {trade['status']}")

# Запускаем
asyncio.run(main())
```

## Расширение функциональности

Для добавления нового источника данных:

1. Создайте класс, наследующийся от `MarketDataProvider`
2. Реализуйте все абстрактные методы
3. Зарегистрируйте провайдер в агрегаторе данных

```python
from src.api.multi_source_provider import get_market_aggregator, MarketDataProvider

# Создаем новый провайдер
class NewMarketProvider(MarketDataProvider):
    # Реализация методов...
    
# Регистрируем провайдер
aggregator = get_market_aggregator()
aggregator.register_provider("new_source", NewMarketProvider())
```

## Запуск тестов

Для запуска модульных тестов:

```
python -m unittest src/api/tests/test_multi_source_market_provider.py
```

Для запуска интеграционных тестов:

```
python -m unittest src/api/tests/test_multi_source_integration.py
``` 